{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>{{ table.name }} - –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</title>
    <link rel="stylesheet" href="{% static 'css/tableform.css' %}">
   
</head>
<body>
    <h1>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É: {{ table.name }}</h1>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ -->
    <form method="POST" class="table-form">
        {% csrf_token %}
        
        <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ -->
        {% if form.errors %}
            <div class="error-messages">
                <ul>
                    {% for field in form %}
                        {% if field.errors %}
                            <li>{{ field.label }}: {{ field.errors|join:", " }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã -->
        {% for field in form %}
            {% if field.name != "manually_updated" and field.name != "last_updated" and field.name != "updated_by" and field.name != "record_date" and field.name != "due_date" and field.name != "inquiry_date" and field.name != "deal_amount" and field.name != "deal_amount_currency" and field.name != "paid_amount" and field.name != "paid_amount_currency" and field.name != "expected_profit" and field.name != "expected_profit_currency" and field.name != "change_status_contact" and field.name != "status" and field.name != "contact" and field.name != "priority" %}
                <p>
                    {{ field.label_tag }}
                    {{ field }}
                </p>
            {% endif %}
        {% endfor %}
    
                 <!-- üü¢ –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ "–ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–∞–∫—Ç—É" -->
                 <p>
                    {{ form.change_status_contact.label_tag }}
                    <select name="change_status_contact" id="id_change_status_contact" class="form-control">
                        {% for value, label in form.fields.change_status_contact.choices %}
                            <option value="{{ value }}" {% if form.change_status_contact.value == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                        {% endfor %}
                    </select>
                </p>

    <!-- üü¢ –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ "–°—Ç–∞—Ç—É—Å" -->
    <p>
        {{ form.status.label_tag }}
        <select name="status" id="id_status" class="form-control">
            {% for value, label in form.fields.status.choices %}
                <option value="{{ value }}" {% if form.status.value == value %}selected{% endif %}>
                    {{ label }}
                </option>
            {% endfor %}
        </select>
    </p>

    <!-- üü¢ –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ "–ö–æ–Ω—Ç–∞–∫—Ç" -->
    <p>
        {{ form.contact.label_tag }}
        <select name="contact" id="id_contact" class="form-control">
            {% for value, label in form.fields.contact.choices %}
                <option value="{{ value }}" {% if form.contact.value == value %}selected{% endif %}>
                    {{ label }}
                </option>
            {% endfor %}
        </select>
    </p>

    <!-- üü¢ –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ "–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç" -->
    <p>
        {{ form.priority.label_tag }}
        <select name="priority" id="id_priority" class="form-control">
            {% for value, label in form.fields.priority.choices %}
                <option value="{{ value }}" {% if form.priority.value == value %}selected{% endif %}>
                    {{ label }}
                </option>
            {% endfor %}
        </select>
    </p>
    <!-- –í—ã–≤–æ–¥ –ø–æ–ª–µ–π —Å—É–º–º –∏ –≤–∞–ª—é—Ç –≤—Ä—É—á–Ω—É—é -->
    
        <label for="id_deal_amount">–°—É–º–∞ —É–≥–æ–¥–∏:</label>
    <div class="currency-field">    
        <input type="number" step="any" inputmode="decimal" lang="en" 
       name="deal_amount" 
       value="{{ form.deal_amount.value|default_if_none:''|stringformat:'.2f'|cut:','|default_if_none:'' }}" 
       id="id_deal_amount" class="form-control currency-input">
        <select name="deal_amount_currency" id="id_deal_amount_currency" class="form-control currency-select">
            <option value="UAH" {% if form.deal_amount_currency.value == "UAH" %}selected{% endif %}>UAH</option>
            <option value="USD" {% if form.deal_amount_currency.value == "USD" %}selected{% endif %}>USD</option>
            <option value="EUR" {% if form.deal_amount_currency.value == "EUR" %}selected{% endif %}>EUR</option>
        </select>
    </div>

    
        <label for="id_paid_amount">–û–ø–ª–∞—á–µ–Ω–∞ —Å—É–º–∞:</label>
    <div class="currency-field">    
        <input type="number" step="any" inputmode="decimal" lang="en" 
           name="paid_amount" 
           value="{{ form.paid_amount.value|default_if_none:''|stringformat:'.2f'|cut:','|default_if_none:'' }}" 
           id="id_paid_amount" class="form-control currency-input">
        <select name="paid_amount_currency" id="id_paid_amount_currency" class="form-control currency-select">
            <option value="UAH" {% if form.paid_amount_currency.value == "UAH" %}selected{% endif %}>UAH</option>
            <option value="USD" {% if form.paid_amount_currency.value == "USD" %}selected{% endif %}>USD</option>
            <option value="EUR" {% if form.paid_amount_currency.value == "EUR" %}selected{% endif %}>EUR</option>
        </select>
    </div>

    
        <label for="id_expected_profit">–û—á—ñ–∫—É–≤–∞–Ω–∏–π –ø—Ä–∏–±—É—Ç–æ–∫:</label>
    <div class="currency-field">    
        <input type="number" step="any" inputmode="decimal" lang="en" 
        name="expected_profit" 
        value="{{ form.expected_profit.value|default_if_none:''|stringformat:'.2f'|cut:','|default_if_none:'' }}" 
        id="id_expected_profit" class="form-control currency-input">
        <select name="expected_profit_currency" id="id_expected_profit_currency" class="form-control currency-select">
            <option value="UAH" {% if form.expected_profit_currency.value == "UAH" %}selected{% endif %}>UAH</option>
            <option value="USD" {% if form.expected_profit_currency.value == "USD" %}selected{% endif %}>USD</option>
            <option value="EUR" {% if form.expected_profit_currency.value == "EUR" %}selected{% endif %}>EUR</option>
        </select>
    </div>

     <!-- –ü–æ–ª—è –¥–∞—Ç + –≤—Ä–µ–º–µ–Ω–∏ -->
    <p>
        {{ form.record_date.label_tag }}
        <input type="datetime-local" name="record_date" 
               value="{{ form.record_date.value|date:'Y-m-d\TH:i' }}" 
               id="id_record_date" class="form-control">
    </p>

    <p>
        {{ form.due_date.label_tag }}
        <input type="datetime-local" name="due_date" 
               value="{{ form.due_date.value|date:'Y-m-d\TH:i' }}" 
               id="id_due_date" class="form-control">
    </p>

    <p>
        {{ form.inquiry_date.label_tag }}
        <input type="datetime-local" name="inquiry_date" 
               value="{{ form.inquiry_date.value|date:'Y-m-d\TH:i' }}" 
               id="id_inquiry_date" class="form-control">
    </p>
         <!-- –ü–æ–ª–µ manually_updated -->
    <div class="field-manually_updated">
        {{ form.manually_updated.label_tag }}
        {{ form.manually_updated }}
    </div>

    <!-- –ü–æ–ª–µ updated_by (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div class="field-updated_by" style="display: none;">
        {{ form.updated_by.label_tag }}
        {{ form.updated_by }}
    </div>

       
        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <button type="submit" class="btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <a href="{% url 'custom_row_list' table.id %}" class="btn-cancel">–û—Ç–º–µ–Ω–∞</a>
    </form>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ) -->
    <script>
        // –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞)
        document.querySelectorAll('[data-pk]').forEach(row => {
            const pk = row.dataset.pk;
            row.querySelector('#id_contact').addEventListener('change', () => {
                // –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const manualCheckbox = document.getElementById('id_manually_updated');
            const updatedByField = document.querySelector('.field-updated_by');
        
            function toggleUpdatedBy() {
                if (manualCheckbox.checked) {
                    updatedByField.style.display = 'block';
                    updatedByField.querySelector('select').disabled = false;
                } else {
                    updatedByField.style.display = 'none';
                    updatedByField.querySelector('select').disabled = true;
                }
            }
        
            if (manualCheckbox && updatedByField) {
                manualCheckbox.addEventListener('change', toggleUpdatedBy);
                toggleUpdatedBy(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            }
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll(".currency-input").forEach(input => {
                input.addEventListener("input", function() {
                    this.value = this.value.replace(",", "."); // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
                });
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll("input[type='datetime-local']").forEach(input => {
                input.addEventListener("blur", function() {
                    if (this.value.length === 10) { // –ï—Å–ª–∏ –≤–≤–µ–ª–∏ —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É
                        this.value += "T00:00"; // –î–æ–±–∞–≤–ª—è–µ–º 00:00 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    }
                });
            });
        });
    </script>
       
    
</body>
</html>