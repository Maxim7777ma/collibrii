{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>{{ table.name }} - Добавить строку</title>
    <link rel="stylesheet" href="{% static 'css/tableform.css' %}">
   
</head>
<body>
    <h1>Добавить строку в таблицу: {{ table.name }}</h1>

    <!-- Форма добавления строки -->
    <form method="POST" class="table-form">
        {% csrf_token %}
        
        <!-- Отображение ошибок -->
        {% if form.errors %}
            <div class="error-messages">
                <ul>
                    {% for field in form %}
                        {% if field.errors %}
                            <li>{{ field.label }}: {{ field.errors|join:", " }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        <!-- Отображение полей формы -->
        {% for field in form %}
            {% if field.name != "manually_updated" and field.name != "updated_by" %}
                <p>
                    {{ field.label_tag }}
                    {{ field }}
                </p>
            {% endif %}
        {% endfor %}
         <!-- Поле manually_updated -->
    <div class="field-manually_updated">
        {{ form.manually_updated.label_tag }}
        {{ form.manually_updated }}
    </div>

    <!-- Поле updated_by (скрыто по умолчанию) -->
    <div class="field-updated_by" style="display: none;">
        {{ form.updated_by.label_tag }}
        {{ form.updated_by }}
    </div>

       
        <!-- Кнопки -->
        <button type="submit" class="btn-save">Сохранить</button>
        <a href="{% url 'custom_row_list' table.id %}" class="btn-cancel">Отмена</a>
    </form>

    <!-- Скрипт для динамических изменений (опционально, если нужно) -->
    <script>
        // Если требуется дополнительная логика (например, автоматическое изменение статуса)
        document.querySelectorAll('[data-pk]').forEach(row => {
            const pk = row.dataset.pk;
            row.querySelector('#id_contact').addEventListener('change', () => {
                // Логика обработки изменений (дополнительно, если требуется)
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const manualCheckbox = document.getElementById('id_manually_updated');
            const updatedByField = document.querySelector('.field-updated_by');
        
            function toggleUpdatedBy() {
                if (manualCheckbox.checked) {
                    updatedByField.style.display = 'block';
                    updatedByField.querySelector('select').disabled = false;
                } else {
                    updatedByField.style.display = 'none';
                    updatedByField.querySelector('select').disabled = true;
                }
            }
        
            if (manualCheckbox && updatedByField) {
                manualCheckbox.addEventListener('change', toggleUpdatedBy);
                toggleUpdatedBy(); // Инициализация при загрузке
            }
        });
    </script>
       
    
</body>
</html>